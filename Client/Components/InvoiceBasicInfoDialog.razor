@using Syncfusion.Blazor.Popups
@using Syncfusion.Blazor.Inputs
@using Syncfusion.Blazor.DropDowns
@using Syncfusion.Blazor.Calendars
@using Syncfusion.Blazor.Buttons
@using AutoDealerSphere.Shared.Models
@using System.ComponentModel.DataAnnotations

<SfDialog @ref="_dialog" Width="600px" IsModal="true" ShowCloseIcon="true" @bind-Visible="_isVisible">
    <DialogTemplates>
        <Header>
            <span>@(_isNew ? "請求書基本情報入力" : "請求書基本情報編集")</span>
        </Header>
        <Content>
            @if (_model != null)
            {
                <div class="invoice-basic-info-dialog">
                    <EditForm Model="@_model" OnValidSubmit="OnValidSubmit">
                        <DataAnnotationsValidator />
                        <ValidationSummary />

                        <div class="form-row">
                        <label>請求書番号</label>
                        <SfTextBox Value="@GetInvoiceNumberDisplay()" Readonly="true"></SfTextBox>
                    </div>
                    
                    <div class="form-row">
                        <label class="required">顧客</label>
                        <SfDropDownList TValue="int" TItem="AutoDealerSphere.Shared.Models.Client" 
                            @bind-Value="@_model.ClientId" 
                            DataSource="@_clients"
                            Placeholder="顧客を選択"
                            AllowFiltering="true"
                            Enabled="@(!_isAddMode)">
                            <DropDownListFieldSettings Value="Id" Text="Name"></DropDownListFieldSettings>
                            <DropDownListEvents TValue="int" TItem="AutoDealerSphere.Shared.Models.Client" ValueChange="OnClientChanged"></DropDownListEvents>
                        </SfDropDownList>
                        <ValidationMessage For="@(() => _model.ClientId)" />
                    </div>
                    
                    <div class="form-row">
                        <label>車両</label>
                        <SfDropDownList TValue="int?" TItem="Vehicle" 
                            @bind-Value="@_model.VehicleId" 
                            DataSource="@_vehicles"
                            Placeholder="車両を選択（任意）"
                            Enabled="@(_vehicles != null && _vehicles.Any())">
                            <DropDownListFieldSettings Value="Id" Text="LicensePlateNumber"></DropDownListFieldSettings>
                        </SfDropDownList>
                        <ValidationMessage For="@(() => _model.VehicleId)" />
                    </div>
                    
                    <div class="form-row">
                        <label class="required">請求日</label>
                        <SfDatePicker @bind-Value="_model.InvoiceDate" Format="yyyy/MM/dd"></SfDatePicker>
                        <ValidationMessage For="@(() => _model.InvoiceDate)" />
                    </div>
                    
                    <div class="form-row">
                        <label class="required">作業完了日</label>
                        <SfDatePicker @bind-Value="_model.WorkCompletedDate" Format="yyyy/MM/dd"></SfDatePicker>
                        <ValidationMessage For="@(() => _model.WorkCompletedDate)" />
                    </div>
                    
                    <div class="form-row">
                        <label>次回車検日</label>
                        <SfDatePicker @bind-Value="_model.NextInspectionDate" Format="yyyy/MM/dd"></SfDatePicker>
                    </div>
                    
                    <div class="form-row">
                        <label>走行距離</label>
                        <SfNumericTextBox @bind-Value="_model.Mileage" Placeholder="走行距離" Format="N0"></SfNumericTextBox>
                    </div>
                    
                    <div class="form-row">
                        <label>備考</label>
                        <SfTextBox @bind-Value="_model.Notes" Multiline="true" Placeholder="備考"></SfTextBox>
                    </div>
                    
                        <div class="dialog-buttons">
                            <SfButton Type="ButtonType.Submit" IsPrimary="true">保存</SfButton>
                            <SfButton @onclick="Cancel">キャンセル</SfButton>
                        </div>
                    </EditForm>
                </div>
            }
        </Content>
    </DialogTemplates>
</SfDialog>