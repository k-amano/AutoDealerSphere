@page "/userlist"
@inject NavigationManager NavigationManager
@inject HttpClient Http
@using Syncfusion.Blazor.Data
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.DataForm
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Newtonsoft.Json
@using AutoDealerSphere.Shared.Models

<SfBreadcrumb>
    <BreadcrumbItems>
        <BreadcrumbItem IconCss="e-icons e-home" Url="/" />
        <BreadcrumbItem Text="ユーザー管理" Url="/" />
    </BreadcrumbItems>
</SfBreadcrumb>

<h2>ユーザー管理</h2>
<h3>ユーザー一覧</h3>

<div class="search-form">
    <EditForm Model="@Search" OnValidSubmit="() => OnSearch(Search)">
        <DataAnnotationsValidator />
        <div class="form">
            <div class="form-row">
                <label>名前</label>
                <SfTextBox @bind-Value="Search.Name" Placeholder="名前"></SfTextBox>
            </div>
            <div class="form-row">
                <label>メールアドレス</label>
                <SfTextBox @bind-Value="Search.Email" Placeholder="メールアドレス"></SfTextBox>
            </div>
            <div class="form-buttons">
                <SfButton Type="ButtonType.Submit">検索</SfButton>
            </div>
        </div>
    </EditForm>
</div>
<br />

<div class="toolbar">
    <SfButton OnClick="AddUser" CssClass="e-primary">新規追加</SfButton>
</div>
<br />

@if (Users.Any())
{
    <SfGrid DataSource="@Users" AllowPaging="true" AllowSorting="true" AllowMultiSorting="true" CssClass="user-grid">
        <GridTemplates>
            <RowTemplate>
                @{
                    var user = context as User;
                    <td colspan="5">
                        <div class="user-row">
                            <span class="user-id">@user.Id</span>
                            <span class="user-name">
                                <span @onclick="() => EditUserFromContext(context)" class="grid-link">
                                    @user.Name
                                </span>
                            </span>
                            <span class="user-email">✉ @user.Email</span>
                            <span class="user-role @(user.Role == 2 ? "admin" : "")">
                                @(user.Role == 2 ? "管理者" : "一般ユーザー")
                            </span>
                        </div>
                    </td>
                }
            </RowTemplate>
        </GridTemplates>
        <GridColumns>
            <GridColumn Field="@nameof(User.Id)" HeaderText="ID" Width="70"></GridColumn>
            <GridColumn Field="@nameof(User.Name)" HeaderText="名前" Width="160"></GridColumn>
            <GridColumn Field="@nameof(User.Email)" HeaderText="メールアドレス"></GridColumn>
            <GridColumn Field="@nameof(User.Role)" HeaderText="権限" Width="120"></GridColumn>
            <GridColumn Field="@nameof(User.Password)" HeaderText="パスワード" Visible="false"></GridColumn>
        </GridColumns>
    </SfGrid>
}
else
{
    <p class="error-message">ユーザー情報が見つかりません。</p>
}

@code {
}