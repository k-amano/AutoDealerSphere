@page "/clientlist"
@inject NavigationManager NavigationManager
@inject HttpClient Http
@using Syncfusion.Blazor.Data
@using Syncfusion.Blazor.Grids
@using Syncfusion.Blazor.Navigations
@using Syncfusion.Blazor.DataForm
@using Syncfusion.Blazor.Buttons
@using Syncfusion.Blazor.Inputs
@using Newtonsoft.Json
@using AutoDealerSphere.Shared.Models

<SfBreadcrumb>
    <BreadcrumbItems>
        <BreadcrumbItem IconCss="e-icons e-home" Url="/" />
        <BreadcrumbItem Text="È°ßÂÆ¢ÁÆ°ÁêÜ" Url="/" />
    </BreadcrumbItems>
</SfBreadcrumb>

<h2>È°ßÂÆ¢ÁÆ°ÁêÜ</h2>
<h3>È°ßÂÆ¢‰∏ÄË¶ß</h3>

<div class="search-form">
    <EditForm Model="@Search" OnValidSubmit="() => OnSearch(Search)">
        <DataAnnotationsValidator />
        <div class="form">
            <div class="form-row">
                <label>ÂêçÂâç„Éª„Ç´„Éä</label>
                <SfTextBox @bind-Value="Search.NameOrKana" Placeholder="ÂêçÂâç„Åæ„Åü„ÅØ„Ç´„Éä"></SfTextBox>
            </div>
            <div class="form-row">
                <label>„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ</label>
                <SfTextBox @bind-Value="Search.Email" Placeholder="„É°„Éº„É´„Ç¢„Éâ„É¨„Çπ"></SfTextBox>
            </div>
            <div class="form-row">
                <label>ÈõªË©±Áï™Âè∑</label>
                <SfTextBox @bind-Value="Search.Phone" Placeholder="ÈõªË©±Áï™Âè∑"></SfTextBox>
            </div>
            <div class="form-row">
                <label>‰ΩèÊâÄ</label>
                <SfTextBox @bind-Value="Search.Address" Placeholder="ÈÉµ‰æøÁï™Âè∑„ÄÅÈÉΩÈÅìÂ∫úÁúå„ÄÅ‰ΩèÊâÄ"></SfTextBox>
            </div>
            <div class="form-buttons">
                <SfButton Type="ButtonType.Submit">Ê§úÁ¥¢</SfButton>
            </div>
        </div>
    </EditForm>
</div>
<br />

<div class="toolbar">
    <SfButton OnClick="AddClient" CssClass="e-primary">Êñ∞Ë¶èËøΩÂä†</SfButton>
</div>
<br />

@if (Clients.Any())
{
    <SfGrid DataSource="@Clients" AllowPaging="true" AllowSorting="true" AllowMultiSorting="true">
        <GridTemplates>
            <RowTemplate>
                @{
                    var client = context as AutoDealerSphere.Shared.Models.Client;
                    <td colspan="9">
                        <div class="client-row">
                            <div class="row-line1">
                                <span class="client-id">@client.Id</span>
                                <span class="client-name">
                                    <span @onclick="() => EditClientFromContext(context)" class="grid-link">
                                        @client.Name
                                    </span>
                                </span>
                                @if (!string.IsNullOrWhiteSpace(client.Kana))
                                {
                                    <span class="client-kana">@client.Kana</span>
                                }
                                @if (!string.IsNullOrWhiteSpace(client.Phone))
                                {
                                    <span class="client-phone">üìû @client.Phone</span>
                                }
                            </div>
                            <div class="row-line2">
                                <span class="client-address">
                                    „Äí@client.Zip @GetPrefectureName(client.Prefecture)@client.Address
                                    @if (!string.IsNullOrWhiteSpace(client.Building))
                                    {
                                        <span> @client.Building</span>
                                    }
                                </span>
                                @if (!string.IsNullOrWhiteSpace(client.Email))
                                {
                                    <span class="client-email">‚úâ @client.Email</span>
                                }
                            </div>
                        </div>
                    </td>
                }
            </RowTemplate>
        </GridTemplates>
        <GridColumns>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Id)" HeaderText="ID"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Name)" HeaderText="ÂêçÂâç"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Kana)" HeaderText="„Ç´„Éä"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Phone)" HeaderText="ÈõªË©±Áï™Âè∑"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Zip)" HeaderText="ÈÉµ‰æøÁï™Âè∑"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Prefecture)" HeaderText="ÈÉΩÈÅìÂ∫úÁúå"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Address)" HeaderText="‰ΩèÊâÄ"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Building)" HeaderText="Âª∫Áâ©Âêç"></GridColumn>
            <GridColumn Field="@nameof(AutoDealerSphere.Shared.Models.Client.Email)" HeaderText="„É°„Éº„É´"></GridColumn>
        </GridColumns>
    </SfGrid>
}
else
{
    <p class="error-message">È°ßÂÆ¢ÊÉÖÂ†±„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇ</p>
}

@code {
}
