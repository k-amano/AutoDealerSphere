# データベース移行手順

## 最新版へのアップデート（2025年8月1日）

以下の重要な変更が行われました：

### 主な変更点

1. **パスワードのハッシュ化**
   - BCrypt.Net-Nextを使用したパスワードハッシュ化を実装
   - 既存の平文パスワードは使用できなくなります

2. **データベース初期化の改善**
   - `DatabaseInitializeService`クラスによる統一的な初期化処理
   - Clientsテーブルのサンプルデータ自動作成を廃止
   - 管理者ユーザー1件のみを自動作成

3. **ログイン機能の実装**
   - ログインAPIの追加（`/api/User/login`）
   - ハッシュ化されたパスワードでの認証

### データベース更新手順

#### 方法1: データベースファイルの削除（推奨）

1. アプリケーションを停止します
2. `Server/Data/crm01.db` ファイルを削除します
3. アプリケーションを再起動します（自動的に新しいデータベースが作成されます）

#### 方法2: 手動でパスワードを更新

既存のデータを保持したい場合は、SQLiteツールを使用して既存ユーザーのパスワードをハッシュ化：

```sql
-- 例: 管理者ユーザーのパスワードを更新
-- 注意: 実際のハッシュ値はBCryptで生成する必要があります
UPDATE Users SET Password = '$2a$11$...' WHERE Email = 'admin@example.com';
```

### 初期ユーザー

データベース再作成後、以下の管理者ユーザーが自動的に作成されます：

- メールアドレス: admin@example.com
- パスワード: admin123
- 権限: 管理者（Role=2）

### 注意事項

1. **パスワードハッシュ化**: 全てのパスワードはBCryptでハッシュ化されて保存されます
2. **既存データ**: データベースを削除すると、全ての既存データが失われます
3. **ユーザー作成・更新**: 新規ユーザー作成や既存ユーザーのパスワード変更時は自動的にハッシュ化されます