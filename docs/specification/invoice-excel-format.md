# 請求書Excel出力フォーマット仕様書

## 1. ファイル仕様

### 1.1 基本情報
- **ファイル形式**: Excel 2007以降（.xlsx）
- **ファイル名**: `請求書_{請求書番号}_{顧客名}_{作成日}.xlsx`
- **例**: `請求書_769-2604_古川自動車商会_20250802.xlsx`

### 1.2 シート構成
- シート名: 「請求書」
- 用紙サイズ: A4
- 印刷の向き: 縦
- 余白: 上下左右 1.5cm

## 2. レイアウト仕様

### 2.1 全体構成
```
行  | 内容
----|------------------
1-3 | ヘッダー部（タイトル）
4-8 | 請求先情報
9-11| 合計金額表示
12  | 空行
13  | 振込先情報
14  | 空行
15  | 明細ヘッダー
16- | 明細データ
    | 小計行
    | 法定費用部
    | 合計部
```

### 2.2 列幅設定
```
列 | 幅（文字数） | 内容
---|------------|-------
A  | 3          | 番号
B  | 25         | 部品名称/項目
C  | 10         | 型式
D  | 15         | 修理方法
E  | 8          | 部品単価
F  | 6          | 個数
G  | 10         | 部品価格
H  | 10         | 工賃
```

## 3. セル詳細仕様

### 3.1 ヘッダー部（行1-3）
```excel
A1:H3 - セル結合
      - 値: "御　請　求　書"
      - フォント: 游ゴシック 16pt 太字
      - 背景色: #90EE90（ライトグリーン）
      - 配置: 中央揃え
```

### 3.2 日付・請求書番号（行4-5）
```excel
F4 - 値: "作成日"
G4 - 値: 令和7年8月2日（フォーマット済み）
F5 - 値: 請求書番号（例: 769-2604）
```

### 3.3 請求先情報（行6-8）
```excel
A6 - 値: "郵便番号"
B6 - 値: 顧客郵便番号
A7 - 値: "住所"
B7:D7 - セル結合、顧客住所
A8 - 値: "氏名"
B8:C8 - セル結合、顧客名 + " 様"
```

### 3.4 自社情報（行6-8右側）
```excel
F6:H6 - セル結合、自社住所
F7:H7 - セル結合、自社名
F8 - 値: "TEL " + 電話番号
H8 - 値: "FAX " + FAX番号
```

### 3.5 合計金額（行10-11）
```excel
A10:C11 - セル結合
        - 値: "¥" + 合計金額（カンマ区切り）
        - フォント: 游ゴシック 20pt 太字
        - 罫線: 太線
        - 配置: 中央揃え
```

### 3.6 振込先情報（行13）
```excel
D13:H13 - セル結合
        - 背景色: #90EE90
        - 値: "銀行振込の場合は、下記口座までお振込みください。"
        - 次行に銀行情報
```

### 3.7 明細ヘッダー（行15）
```excel
各セル - 背景色: #E0FFE0（薄緑）
       - フォント: 太字
       - 罫線: 実線
A15 - "車両番号"
B15 - "部品名称／項目"
C15 - "型式"
D15 - "修理方法"
E15 - "部品単価"
F15 - "個数"
G15 - "部品価格"
H15 - "工賃"
```

### 3.8 明細データ（行16以降）
```excel
- 各行に罫線（細線）
- 数値は右揃え
- 金額はカンマ区切り
- 小計行で一旦罫線（太線）
```

### 3.9 法定費用部
```excel
- 背景色: #E0FFE0（ヘッダーと同色）
- 項目名は左揃え
- 金額は右揃え
```

### 3.10 合計部
```excel
- 小計、消費税、合計の各行
- 合計行は太字
- 罫線: 太線で囲む
```

## 4. フォント・色設定

### 4.1 フォント

#### 推奨フォント（優先順）
1. **游ゴシック（Yu Gothic）**
   - Windows 8.1以降標準搭載
   - 視認性が高く、現代的なデザイン
   - 基本: 游ゴシック Regular 10pt
   - タイトル: 游ゴシック Bold 16pt
   - 合計金額: 游ゴシック Bold 20pt

2. **メイリオ（Meiryo）**
   - Windows Vista以降標準搭載
   - 画面表示・印刷両方で高い可読性
   - 行間が広めで読みやすい

3. **BIZ UDゴシック**
   - Windows 10 October 2018 Update以降標準搭載
   - ユニバーサルデザインフォント
   - ビジネス文書に最適化

#### フォールバック設定
```csharp
// フォント設定の実装例
string[] fontPriority = { "游ゴシック", "Yu Gothic", "メイリオ", "Meiryo", "BIZ UDゴシック", "MS ゴシック" };
```

### 4.2 色設定
- ヘッダー背景: #90EE90（ライトグリーン）
- 明細ヘッダー背景: #E0FFE0（薄緑）
- 法定費用背景: #E0FFE0（薄緑）
- 文字色: 黒（#000000）

## 5. 数値フォーマット

### 5.1 金額
- フォーマット: "#,##0"
- 例: 77,660

### 5.2 数量
- 整数の場合: "0"
- 小数の場合: "0.0"

### 5.3 日付
- フォーマット: "令和y年M月d日"
- 例: 令和7年8月2日

## 6. 印刷設定

### 6.1 ページ設定
- 用紙: A4
- 向き: 縦
- 余白: 上下左右 1.5cm
- ヘッダー/フッター: なし

### 6.2 印刷範囲
- A1から最終データ行まで
- 1ページに収まるよう自動調整

## 7. 実装上の注意点

1. **日本語フォント**: 游ゴシック→メイリオ→MSゴシックの優先順で設定（互換性確保）
2. **セル結合**: 請求書の体裁を保つため、指定通りに結合
3. **罫線**: 視認性のため、適切な太さを使用
4. **色**: 印刷時の視認性を考慮した色設定
5. **改ページ**: 明細が多い場合の改ページ処理

## 8. エラー処理

- 長い文字列: セル内で折り返し
- NULL値: 空文字として処理
- 計算エラー: 0として表示