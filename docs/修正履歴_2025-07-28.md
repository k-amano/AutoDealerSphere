# AutoDealerSphere 修正履歴（2025年7月28日）

## 概要
このドキュメントは、AutoDealerSphereアプリケーションに対して2025年7月28日に実施した修正内容をまとめたものです。

## 主な修正内容

### 1. 車両管理機能の実装

#### 1.1 データモデルの追加
- `Vehicle.cs`モデルを作成し、車両情報を管理するためのエンティティを定義
- 車両情報には以下の項目を含む：
  - 車両基本情報（車名、車種、走行距離など）
  - ナンバープレート情報（地域名、分類番号、ひらがな、番号）
  - 車検情報（有効期限、次回車検日など）
  - 寸法・重量情報
  - エンジン情報（型式、排気量、燃料種別）

#### 1.2 データベースの更新
- `SQLDBContext`にVehiclesテーブルを追加
- ClientとVehicleの1対多リレーションを設定
- データベース初期化処理を改善（既存データを保持するように変更）

### 2. データインポート機能の実装

#### 2.1 インポートサービス
- `VehicleImportService`を作成
- CSVファイル（Shift-JIS）からのデータ読み込み機能
- 顧客IDが空白の場合は自動採番
- 同一氏名の顧客は1つのClientレコードにまとめる処理
- 「岩瀬　艶雄」の住所を「香川県東かがわ市西村1445」に統一

#### 2.2 インポートUI
- `/vehicle-import`ページを作成
- ファイルアップロード機能
- インポート結果の表示（成功件数、エラー詳細）
- Syncfusion Cardsを使用した見やすいUI

### 3. UIの改善

#### 3.1 レイアウトの修正
- ヘッダーにシステムタイトル「AutoDealerSphere - 自動車販売管理システム」を配置
- サイドメニューを縦型に修正（`Orientation="Orientation.Vertical"`）
- 不要なNavMenu.razorとapp.cssを削除

#### 3.2 顧客一覧の改善
- 全カラムを表示（カナ、郵便番号、都道府県、住所、建物名、電話番号）
- 都道府県を数値コードではなく名前で表示
- カラム幅の調整とリサイズ機能の追加（`AllowResizing="true"`）

### 4. Syncfusionパッケージの更新

#### 4.1 バージョンアップ
- Syncfusion.Blazor.*パッケージを25.1.42から30.1.41に更新
- Syncfusion.Blazor.DropDownsパッケージを追加（欠落していた）
- System.Text.Jsonを8.0.3から8.0.5に更新（依存関係の解決）

#### 4.2 コードの修正
- DropDownListの実装を最新の方法に変更
  - 旧: `TextField="Name" ValueField="Code"`属性
  - 新: `<DropDownListFieldSettings Value="Code" Text="Name">`子要素

### 5. エラー修正

#### 5.1 Null参照エラーの解決
- 原因：Syncfusion.Blazor.DropDownsパッケージが不足
- 解決：パッケージの追加とコードの修正

#### 5.2 パッケージダウングレードエラーの解決
- 原因：System.Text.Jsonのバージョン競合
- 解決：8.0.5にアップグレード

## 技術的な注意点

### データベース
- SQLiteを使用
- データベースファイル：`Server/Data/crm01.db`
- Entity Framework Core 8.0.4を使用

### 文字コード
- CSVインポート時はShift-JISエンコーディングに対応
- `Encoding.RegisterProvider(CodePagesEncodingProvider.Instance)`が必要

### Blazorコンポーネント
- razorファイルにロジックを書かず、コードビハインドに実装
- Syncfusionコンポーネントは同一バージョンで統一する必要がある

## 今後の課題

1. 車両一覧画面の作成
2. 車両編集機能の実装
3. 車両検索機能の追加
4. インポート時のバリデーション強化
5. エラーログの改善